---
title: "Raw Data"
author: "Olgiati Stefano (1)"
date: "21 May 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

(1) Author Responsible For Correspondence: University of Bergamo <www.unibg.it>, Department of Quantitative Methods, via dei Caniana 2, Bergamo (ITA) 24129; tel  +39 035 20 52 638; fax +39 035 20 52 549; email <stefano.olgiati@unibg.it>

```{r echo=FALSE, results='hide'}
library(data.table)
```

# Reading raw data in .csv format

````{r}
raw.data.GBD <- read.csv("GBD.csv")
raw.data.WHO <- read.csv("WHO.csv")
names(raw.data.GBD)
names(raw.data.WHO)
dim(raw.data.GBD)
dim(raw.data.WHO)

# Data Tables
attach(raw.data.GBD)
attach(raw.data.WHO)

DT.GBD <- data.table(raw.data.GBD)
DT.WHO <- data.table(raw.data.WHO)

tables()
```


### Tidy Data Set

Manipulating data to generate tidy datasets
```{r}
# ISO3 codes of EU Countries

ISO3 <- c("ARG", "AUS", "BRA", "CAN","CHN","IND","IDN","JPN","MEX","RUS","SAU","ZAF","KOR","TUR","USA", "AUT","BEL","BGR","HRV","CYP","CZE","DNK","EST","FIN","FRA","DEU","GRC","HUN","IRL","ITA","LVA","LTU","LUX","MLT","NLD","POL","PRT","ROU","SVK","SVN","ESP","SWE","GBR")

length(ISO3)

data.GBD <- DT.GBD[DT.GBD$year == "2010" & DT.GBD$age_name == "0-1 years" & DT.GBD$sex_name == "Both" & DT.GBD$iso3 %in% ISO3 , ]
data.GBD.2010.ordered <- data.GBD.2010[order(iso3), ]
data.GBD.2010.ordered

data.WHO <- DT.WHO[DT.WHO$YEAR == "1995" & DT.WHO$GHO == "WHS7_105" & DT.WHO$Numeric != "NA" & DT.WHO$COUNTRY %in% ISO3,  ]
data.WHO.1995.ordered <- data.WHO.1995[order(COUNTRY), ]
data.WHO.1995.ordered

data.1990 <- data.frame(country=data.GBD.1990.ordered$iso3, le=data.GBD.1990.ordered$le, hale=data.GBD.1990.ordered$hale, the=data.WHO.1995.ordered$Numeric)

data.2010 <- data.frame(country=data.GBD.2010.ordered$iso3, le=data.GBD.2010.ordered$le, le_ui = data.GBD.2010.ordered$le_ui, hale=data.GBD.2010.ordered$hale, hale_ui = data.GBD.2010.ordered$hale_ui, the=data.WHO.2010.ordered$Numeric)


# Years Lived with Disease in G20 Countries for 1990 - 2010
yld.1990 <- data.1990$le - data.1990$hale
yld.2010 <- data.2010$le - data.2010$hale

# Tidy Dataset
tidy.data <- data.frame(country=data.2010$country, the_1995=data.1990$the, the_2010=data.2010$the, le_1990=data.1990$le,  le_2010=data.2010$le, le_ui_2010=data.2010$le_ui, hale_ui_2010=data.2010$hale_ui, hale_1990 = data.1990$hale, hale_2010 = data.2010$hale, yld_1990=yld.1990, yld_2010=yld.2010)

attach(tidy.data)

# Saving Tidy Dataset to .csv file
write.csv(tidy.data, "YLDOutput.csv")
```
