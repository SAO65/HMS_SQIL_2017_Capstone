---
title: "Tidy Data"
author: "Olgiati Stefano (1)"
date: "21 May 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

(1) Author Responsible For Correspondence: University of Bergamo <www.unibg.it>, Department of Quantitative Methods, via dei Caniana 2, Bergamo (ITA) 24129; tel  +39 035 20 52 638; fax +39 035 20 52 549; email <stefano.olgiati@unibg.it>

# Reading raw data in .csv format

```{r}
library(data.table)

raw.data.GBD <- read.csv("GBD.csv")
raw.data.WHO.WF <- read.csv("WHO_WF.csv")
raw.data.WHO.THE <- read.csv("WHO_THE.csv")

names(raw.data.GBD)
names(raw.data.WHO.WF)
names(raw.data.WHO.THE)

head(raw.data.GBD)
head(raw.data.WHO.WF)
head(raw.data.WHO.THE)


dim(raw.data.GBD)
dim(raw.data.WHO.WF)
dim(raw.data.WHO.THE)


# Data Tables
attach(raw.data.GBD)
attach(raw.data.WHO.WF)
attach(raw.data.WHO.THE)

DT.GBD <- data.table(raw.data.GBD)
DT.WHO.WF <- data.table(raw.data.WHO.WF)
DT.WHO.THE <- data.table(raw.data.WHO.THE)

tables()
```


### Tidy Data Set

Manipulating data to generate tidy datasets
```{r}
# ISO3 codes of ROW-28 Countries

# Austria, Belgium, Bulgaria, Croatia, Republic of Cyprus, Czech Republic, Denmark, Estonia, Finland, France, Germany, Greece, Hungary, Ireland, Italy, Latvia, Lithuania, Luxembourg, Malta, Netherlands, Poland, Portugal, Romania, Slovakia, Slovenia, Spain, Sweden and the UK

ISO3 <- c("AUT","BEL","BGR","HRV","CYP","CZE","DNK","EST","FIN","FRA","DROW","GRC","HUN","IRL",
          "ITA","LVA","LTU","LUX","MLT","NLD","POL","PRT","ROU","SVK","SVN","ESP","SWE","GBR")

length(ISO3) == 28


data.WHO.WF.RN <- DT.WHO.WF[DT.WHO.WF$GHO..CODE. == "HRH_33" & !
                                        DT.WHO.WF$COUNTRY..CODE. %in% ISO3, ]
data.WHO.WF.RN
df.WHO.RN.spool <- data.frame(country.ROW=data.WHO.WF.RN$COUNTRY..CODE., rn.ROW=data.WHO.WF.RN$Numeric, year=data.WHO.WF.RN$YEAR..CODE.)
df.WHO.RN.spool
df.WHO.WF.RN <- df.WHO.RN.spool[order(df.WHO.RN.spool$country.ROW, abs(df.WHO.RN.spool$year) ), ] 
#sort by country and reverse of abs(year)
df.WHO.WF.RN <- df.WHO.WF.RN[ !duplicated(df.WHO.WF.RN$country.ROW), ]
df.WHO.WF.RN
length(df.WHO.WF.RN$country.ROW)
list(df.WHO.WF.RN$country.ROW)


data.WHO.WF.MD <- DT.WHO.WF[DT.WHO.WF$GHO..CODE. == "HRH_26" & !
                                        DT.WHO.WF$COUNTRY..CODE. %in% ISO3, ]
data.WHO.WF.MD
df.WHO.MD.spool <- data.frame(country.ROW=data.WHO.WF.MD$COUNTRY..CODE., md.ROW=data.WHO.WF.MD$Numeric, year=data.WHO.WF.MD$YEAR..CODE.)
df.WHO.MD.spool
df.WHO.WF.MD <- df.WHO.MD.spool[order(df.WHO.MD.spool$country.ROW, abs(df.WHO.MD.spool$year) ), ] 
#sort by country and reverse of abs(year)
df.WHO.WF.MD <- df.WHO.WF.MD[ !duplicated(df.WHO.WF.MD$country.ROW), ]
df.WHO.WF.MD
length(df.WHO.WF.MD$country.ROW)
list(df.WHO.WF.MD$country.ROW)


df.WHO.WF <- merge(df.WHO.WF.RN, df.WHO.WF.MD, all.x=FALSE, all.y=FALSE, by="country.ROW")
df.WHO.WF

data.GBD <- DT.GBD[DT.GBD$year == "2010" & DT.GBD$age_name == "0-1 years" &
                                DT.GBD$sex_name == "Both" & !
                                DT.GBD$iso3 %in% ISO3, ]
df.GBD <- data.frame(country.ROW=data.GBD$iso3, le.ROW=data.GBD$le, hale.ROW=data.GBD$hale)
df.GBD

data.WHO.THE <- DT.WHO.THE[DT.WHO.THE$YEAR == "2010" & 
                                        DT.WHO.THE$GHO == "WHS7_105" & 
                                        DT.WHO.THE$Numeric != "NA"& !
                                        DT.WHO.THE$COUNTRY %in% ISO3,  ]
df.WHO.THE <- data.frame(country.ROW=data.WHO.THE$COUNTRY, the.ROW=data.WHO.THE$Numeric)
df.WHO.THE


df.merge.1 <- merge(df.GBD, df.WHO.THE, all.x=F, by="country.ROW")
df.merge.1

intermediate.data.ROW <- merge(df.merge.1, df.WHO.WF, all.x=F, all.y=FALSE, by="country.ROW")
intermediate.data.ROW

# Years Lived with Disability, Nursing density and Physicians density
yld.ROW <- intermediate.data.ROW$le.ROW - intermediate.data.ROW$hale.ROW
rn.ROW <- intermediate.data.ROW$rn.ROW
md.ROW <- intermediate.data.ROW$md.ROW
the.ROW <- intermediate.data.ROW$the.ROW

# Care Intensity, Care Index amd Care Value
CareI.ROW <- rn.ROW / md.ROW
TreatmentI.ROW <- md.ROW / yld.ROW
CareX.ROW <- CareI.ROW * TreatmentI.ROW # (rn / md) * (md / yld) = rn / yld
CareV.ROW <- the.ROW * CareX.ROW


# Tidy Dataset
tidy.data.ROW <- data.frame(intermediate.data.ROW, yld.ROW, CareI.ROW, TreatmentI.ROW, CareX.ROW, CareV.ROW)
tidy.data.ROW

attach(tidy.data.ROW)

# Saving Tidy Dataset to .csv file
write.csv(tidy.data.ROW, "Workforce_Output_ROW.csv")
```


